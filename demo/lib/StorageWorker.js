!function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}function t(e){this.value=e}function r(e){var t=[];return e.forEach(function(e){t.push(e)}),t}function n(e){var t=Object.create(null);return e.forEach(function(e,r){t[r]=e}),t}function i(e,t){var r,n;if(Array.isArray(e)){if(!0===t.set){var o=new Set;for(r=0,n=e.length;r<n;r++)o.add(i(e[r],t));return o}for(r=0,n=e.length;r<n;r++)e[r]=i(e[r],t);return e}if(typeof e===Se&&null!==e){var a,u=Object.keys(e);if(!0===t.map){var f=new Map;for(r=0,n=u.length;r<n;r++)a=u[r],f.set(a,i(e[a],t));return f}for(r=0,n=u.length;r<n;r++)e[a=u[r]]=i(e[a],t);return e}return e}function o(e,t,r){!0===t.toJSON&&typeof e===Ee&&null!==e&&"function"==typeof e.toJSON&&(e=e.toJSON());var n=typeof e;switch(n){case Be:return e.toString();case Re:return JSON.stringify(e);case Ae:if(!isFinite(e))throw new TypeError(e+" is not JSON valid");return 0===e&&1/e==-1/0?"-0":e.toString()}if(null===e)return"null";var i="",u="",f="",s="",l="";if(t.indent)if(l=" ",r>t.maxIndentLevel)i="",s=" ";else{i="\n",s="\n";for(var c=0;c<r;c++)u+=t.indent;for(var p=0;p<r-1;p++)f+=t.indent}var y=t.replacer,v="";if(Array.isArray(e)){v+="[";for(var h=0,g=e.length;h<g;h++){var O=e[h];y&&void 0===(O=y.call(e,h,O))?h===g-1&&v.length>1&&(v=v.slice(0,-1)):(i&&v[v.length-1]!==i&&(v+=i),v+=u+o(O,t,r+1),v+=h!==g-1?","+s:i+f)}v+="]"}else if(a.Set&&e instanceof Set){v+="[";var S=0;e.forEach(function(n){if(y&&void 0===(n=y.call(e,n,n)))return S===e.size-1&&v.length>1&&(v=v.slice(0,-1)),void S++;0===S&&(v+=i),v+=u+o(n,t,r+1),S++!=e.size-1?v+=","+s:v+=i+f}),v+="]"}else if(a.Map&&e instanceof Map){v+="{";var d=0;e.forEach(function(n,a){if(typeof a!==Re)throw new TypeError(a+" key is not a string");if("toJSON"!==a||"function"!=typeof n){if(y&&void 0===(n=y.call(e,a,n)))return d===e.size-1&&v.length>1&&(v=v.slice(0,-1)),void d++;0===d&&(v+=i),v+=u+JSON.stringify(a)+":"+l+o(n,t,r+1),d++!=e.size-1?v+=","+s:v+=i+f}}),v+="}"}else{if(n!==Ee)throw new TypeError(e+" is not JSON valid");v+="{";for(var N=Object.keys(e),E=0,A=N.length;E<A;E++){var R=N[E],B=e[R];"toJSON"===R&&"function"==typeof B||(y&&void 0===(B=y.call(e,R,B))?E===A-1&&v.length>1&&(v=v.slice(0,-1)):(i&&v[v.length-1]!==i&&(v+=i),v+=u+JSON.stringify(R)+":"+l+o(B,t,r+1),v+=E!==A-1?","+s:i+f))}v+="}"}return v}var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u=e(function(e,t){var r=t.NUMBER="number",n=t.BOOLEAN="boolean",i=t.NULL="null",o=t.STRING="string";t.PRIMITIVES=[r,n,i,o];var a=t.ARRAY="array",u=t.OBJECT="object";t.STRUCTURES=[a,u]});u.NUMBER,u.BOOLEAN,u.NULL,u.STRING,u.PRIMITIVES,u.ARRAY,u.OBJECT,u.STRUCTURES;t.prototype.toJSON=function(){return this.value};var f=t,s=u.OBJECT,l=function e(t){if(typeof t!==s||null===t)return t;var r,n,i;if(Array.isArray(t))for(r=[],n=0,i=t.length;n<i;n++)r[n]=e(t[n]);else if(a.Set&&t instanceof Set)r=new Set,t.forEach(function(t){r.add(e(t))});else if(a.Map&&t instanceof Map)r=new Map,t.forEach(function(t,n){r.set(n,e(t))});else{r={};var o=Object.keys(t);for(n=0,i=o.length;n<i;n++){var u=o[n];r[u]=e(t[u])}}return r},c=u,p=c.OBJECT,y=c.ARRAY,v=c.NULL,h=c.STRING,g=c.BOOLEAN,O=c.NUMBER,S=function(e){var t=typeof e;if(t===g||t===h)return t;if(t===O&&isFinite(e))return O;if(t===p){if(Array.isArray(e))return y;if(a.Set&&e instanceof Set)return y;if(a.Map&&e instanceof Map)return p;if(null===e)return v;if(t===p)return p}},d=u,N=d.OBJECT,E=d.ARRAY,A=d.STRING,R=d.BOOLEAN,B=d.NUMBER,M=d.NULL,w=S,T=function e(t,i){var o=w(t);if(o!==w(i))return!1;var u=o;switch(u){case B:return 0===t&&1/t==-1/0?0===i&&1/i==-1/0:t===i;case A:case M:case R:return t===i}var f,s;if(u===E){if(a.Set&&(t instanceof Set&&(t=r(t)),i instanceof Set&&(i=r(i))),t.length!==i.length)return!1;for(f=0,s=t.length;f<s;f++)if(!e(t[f],i[f]))return!1;return!0}if(u===N){a.Map&&(t instanceof Map&&(t=n(t)),i instanceof Map&&(i=n(i)));var l=Object.keys(t);if(l.length!==Object.keys(i).length)return!1;for(f=0,s=l.length;f<s;f++){var c=l[f];if(i.hasOwnProperty&&!i.hasOwnProperty(c))return!1;if(!e(i[c],t[c]))return!1}return!0}return!0},J=u.OBJECT,b=T,L=function(e,t){if(void 0===t)return!1;if(typeof e!==J||null===e)return!1;var r,n;if(Array.isArray(e)){for(r=0,n=e.length;r<n;r++)if(b(e[r],t))return!0;return!1}if(a.Map&&e instanceof Map||a.Set&&e instanceof Set){var i=e.entries();for(r=0,n=e.size;r<n;r++){var o=i.next().value;if(b(o[1],t)&&void 0!==o[0])return!0}return!1}var u=Object.keys(e);for(r=0,n=u.length;r<n;r++){var f=u[r];if(b(e[f],t))return!0}return!1},m=a.Set?function(e){return Array.isArray(e)||e instanceof Set}:Array.isArray,I=m,U=u.OBJECT,C=a.Map?function(e){return e instanceof Map||typeof e===U&&null!==e&&!I(e)}:function(e){return typeof e===U&&null!==e&&!I(e)},z=C,j=T,k=u.STRING,x=Object.prototype.hasOwnProperty,G=function(e,t){if(typeof t!==k)return!1;if(!z(e))return!1;if(a.Map&&e instanceof Map){for(var r=e.keys(),n=0,i=e.size;n<i;n++){var o=r.next().value;if(j(o,t))return void 0!==e.get(o)}return!1}return x.call(e,t)&&void 0!==e[t]},V=L,P=G,F=function(e,t){return Array.isArray(e)||a.Set&&e instanceof Set?V(e,t):P(e,t)},Y=u.BOOLEAN,q=function(e){return typeof e===Y},W=u,K=W.NUMBER,D=W.OBJECT,_=W.BOOLEAN,H=W.STRING,Q=function(e){var t=typeof e;return t===_||t===H||t===D||t===K&&isFinite(e)},X=function(e){return null===e},Z=u.NUMBER,$=function(e){return typeof e===Z&&isFinite(e)},ee=u,te=ee.BOOLEAN,re=ee.STRING,ne=ee.NUMBER,ie=function(e){if(null===e)return!0;var t=typeof e;return!(t!==ne||!isFinite(e))||(t===te||t===re||null===e)},oe=u.STRING,ae=function(e){return typeof e===oe},ue=u.OBJECT,fe=function(e){return typeof e===ue&&null!==e},se=u,le=se.NUMBER,ce=se.OBJECT,pe=se.BOOLEAN,ye=se.STRING,ve=se.NULL,he=se.ARRAY,ge=Object.create(null);ge[he]=m,ge[pe]=q,ge.JSON=Q,ge[ve]=X,ge[le]=$,ge[ce]=C,ge.primitive=ie,ge[ye]=ae,ge.structure=fe;for(var Oe=function(e,t){var r=ge[t];if(!r)throw new Error(t+" is not a valid type");return r(e)},Se=u.OBJECT,de=function(e,t){var r=JSON.parse(e);return typeof t!==Se||null===t?r:i(r,t)},Ne=u,Ee=Ne.OBJECT,Ae=Ne.NUMBER,Re=Ne.STRING,Be=Ne.BOOLEAN,Me=function(e,t){t="object"==typeof t&&null!==t?t:Object.create(null);var r=Object.create(null);if(r.toJSON=!1!==t.toJSON,r.replacer="function"==typeof t.replacer&&t.replacer,r.indent="",t.space)if("number"==typeof t.space&&t.space>=1)for(var n=0;n<t.space;n++)r.indent+=" ";else"string"==typeof t.space&&(r.indent=t.space);return r.maxIndentLevel=t.maxIndentLevel,o(e,r,1).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},we=u,Te=we.OBJECT,Je=we.STRING,be=we.BOOLEAN,Le=we.NUMBER,me=function e(t){var r=typeof t;switch(r){case Je:case be:return!0;case Le:return isFinite(t)}if(null===t)return!0;if(r!==Te)return!1;var n,i,o;if(a.Set&&t instanceof Set){var u=t.values();for(n=0,i=t.size;n<i;n++)if(!e(u.next().value))return!1;return!0}if(a.Map&&t instanceof Map){var f=t.entries();for(n=0,i=t.size;n<i;n++){if("string"!=typeof(o=f.next().value)[0])return!1;if(!e(o[1]))return!1}return!0}if(Array.isArray(t)){for(n=0,i=t.length;n<i;n++)if(!e(t[n]))return!1;return!0}var s=Object.keys(t);for(n=0,i=s.length;n<i;n++)if(!e(t[s[n]]))return!1;return!0},Ie=e(function(e){var t=u,r=f,n=e.exports=function(e){return new r(e)};n.clone=l,n.Document=r,n.equal=T,n.has=F,n.hasKey=G,n.hasValue=L,n.is=Oe,n.isArray=m,n.isBoolean=q,n.isJSON=Q,n.isNull=X,n.isNumber=$,n.isObject=C,n.isPrimitive=ie,n.isString=ae,n.isStructure=fe,n.parse=de,n.serialize=Me,n.type=S;for(var i in t)n[i]=t[i];n.valid=me,["has","hasKey","hasValue","is","isArray","isBoolean","isJSON","isNull","isNumber","isObject","isPrimitive","isString","isStructure","serialize","type","valid"].forEach(function(e){var t=n[e];r.prototype[e]=function(){var e=[this.value].concat(arguments);return t.apply(null,e)}}),r.prototype.toString=function(){return n.serialize(this.value)},r.prototype.clone=function(){return new r(n.clone(this.value))},r.prototype.equal=function(e){return n.equal(this.value,e instanceof r?e.value:e)},r.prototype.parse=function(){this.value=n.parse.apply(null,[this.value].concat(arguments))}}),Ue=(e(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}}),[]),Ce=0;Ce<256;++Ce)Ue[Ce]=(Ce+256).toString(16).substr(1);const ze=Ie,je=e=>{try{return ze.parse(atob(e))}catch(t){return atob(e)}},ke=Ie;let xe=new Map,Ge=new Map;class Ve{constructor(){this.types=new Map([["put",this.put],["get",this.get],["serialize",this.serialize],["delete",this.delete]])}put(e,t){for(let r of e){if(Ge.has("put")){let e={};e[r.key]=r,Ge.get("put")(e,t)}xe.set(r.key,r)}}get(e,t){let r=xe.get(e);Ge.has("get")&&Ge.get("get")(r,t),postalSharedWorker.fire("entourage-storage-response",r,t)}serialize(e,t){let r=ke.serialize({action:"serialize",store:xe});Ge.has("serialize")&&Ge.get("serialize")(t),console.warn(t),postalSharedWorker.fire("entourage-storage-response",r,"private",t)}delete(e){Ge.has("delete")&&Ge.get("delete")(e),xe.delete(e)}on(e,t){Ge.set(e,t)}un(e){Ge.get("un")&&Ge.get("un")(e),Ge.delete(e)}_start(){postalSharedWorker.on("entourage-storage",(e,t)=>{let r=e.action,n=e.requests.map(e=>je(e));this.types.get(r)&&this.types.get(r)(n,t)})}}const Pe=new Ve;Pe._start(),self.getStorageWorker=(()=>Pe),self.getStore=(()=>xe),self.getEvents=(()=>Ge)}();
